<!DOCTYPE mapper PUBLIC "-//mapper.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.jarvis.ws.medicine.repository.StockRepository">

    <insert id="createSupplying" parameterType="Supplying" useGeneratedKeys="true" keyProperty="id" keyColumn="id">
        INSERT INTO ph_supplying (quantity, unit_price, created_by, expiry_date, publish_date, unit_type, product_id, supplier_id, user_id)
        VALUES (#{quantity}, #{unitPrice}, #{username}, #{expiryDate}, #{publishDate}, #{unitType}, #{medicineId}, #{supplierId}, #{userId})
    </insert>

    <insert id="createStock" parameterType="MedicineStock" useGeneratedKeys="true" keyProperty="id" keyColumn="id">
        INSERT INTO ph_stock (post_quantity, remaining_alert, created_by, product_id)
        VALUES (#{postQuantity}, #{remainingAlert}, #{username}, #{medicineId})
    </insert>

    <select id="getStockByMedicineId" parameterType="int"
            resultMap="org.jarvis.ws.medicine.ResultMapper.StockEntityResult">
        SELECT medicineStock.*,medicineStock.id AS stock_id FROM ph_stock AS medicineStock
        INNER JOIN ph_product AS pro ON pro.id = medicineStock.product_id
        WHERE medicineStock.product_id = #{id} AND pro.status = 'active'
    </select>

    <select id="listSupplying" parameterType="int" resultType="Map">
        SELECT * FROM ph_supplying WHERE user_id = #{userId}
    </select>


    <!--<select id="listMedicineStockByMedicineId" resultMap="org.jarvis.ws.medicine.ResultMapper.MedicineStockEntityResult">
        SELECT * FROM ph_medicine_stock WHERE medicine_id = #{medicineId} ORDER BY id DESC
    </select>-->

    <!--<select id="getMedicineStockById" resultMap="org.jarvis.ws.medicine.ResultMapper.MedicineStockEntityResult">
        SELECT * FROM ph_medicine_stock WHERE id = #{id}
    </select>-->

</mapper>