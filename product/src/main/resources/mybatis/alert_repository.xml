<!DOCTYPE mapper PUBLIC "-//mapper.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.jarvis.ws.medicine.repository.AlertRepository">

    <insert id="createAlertLog" parameterType="AlertEntity" useGeneratedKeys="true" keyProperty="id" keyColumn="id">
          INSERT INTO ph_alert_log (created_by, content, "type", status, response)
          VALUES (#{createdBy}, #{content}, #{alertType}, #{status}, #{response})
    </insert>

    <insert id="createInbox" parameterType="InboxEntity" useGeneratedKeys="true" keyProperty="id" keyColumn="id">
          INSERT INTO ph_inbox (created_by, message, title, user_id, "type")
          VALUES (#{createdBy}, #{message}, #{title}, #{userId}, #{type})
    </insert>

    <select id="list" resultType="InboxEntity">
        SELECT * FROM ph_inbox WHERE user_id = #{userId} AND "type" = #{type} ORDER BY created_date DESC
    </select>

    <select id="getBadge" parameterType="int" resultType="int">
        SELECT COUNT(id) FROM ph_inbox WHERE user_id = #{userId} AND seen = false AND "type" = 'notification'
    </select>

    <update id="clearBadge" parameterType="int">
        UPDATE ph_inbox SET seen = true WHERE user_id = #{userId} AND seen = false AND "type" = 'notification'
    </update>

    <insert id="saveToken" parameterType="Token" useGeneratedKeys="true" keyProperty="id" keyColumn="id">
          INSERT INTO ph_fcm_token (token, status, badge, platform)
          VALUES (#{token}, #{status}, #{badge}, #{platform})
    </insert>

    <select id="hasToken" parameterType="string" resultType="Token">
        SELECT * FROM ph_fcm_token WHERE token = #{token}
    </select>

</mapper>