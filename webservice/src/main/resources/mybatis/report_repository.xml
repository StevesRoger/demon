<!DOCTYPE mapper PUBLIC "-//mapper.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.jarvis.ws.medicine.repository.ReportRepository">

    <select id="listOrder" parameterType="Map" resultType="ReportEntity">
        SELECT id,remark,created_date AS createdDate, total_amount AS totalOrder
        FROM ph_order
        WHERE user_id = #{userId}
        <if test="startDate != null and endDate != null">
            AND date_trunc('day',created_date) BETWEEN #{startDate} AND #{endDate}
        </if>
        ORDER BY created_date DESC
    </select>

    <select id="listOrderItem" parameterType="int" resultType="ReportItemEntity">
        SELECT med.id,med.brand,med.label,med.composition,med.name,
        med.name_kh AS nameKh,med.unit_type AS unitType, proOrder.quantity,
        proOrder.unit_price AS unitPrice,ord.created_date AS createdDate
        FROM ph_product_order AS proOrder
        INNER JOIN ph_product AS med ON proOrder.product_id = med.id
        INNER JOIN ph_order AS ord ON ord.id = proOrder.order_id
        WHERE proOrder.order_id = #{id}
    </select>

    <select id="listSupplyingItem" parameterType="Map" resultType="ReportItemEntity">
        SELECT med.id, med.brand, med.label, med.composition, med.name,
        med.name_kh AS nameKh, supp.unit_type AS unitType, supp.quantity,
        supp.unit_price AS unitPrice, supp.created_date AS createdDate,
        expiry_date AS expiryDate, publish_date AS publishDate
        FROM ph_supplying AS supp
        INNER JOIN ph_product AS med ON supp.product_id = med.id
        WHERE user_id = #{userId}
        <if test="startDate != null and endDate != null">
            AND date_trunc('day',supp.created_date) BETWEEN #{startDate} AND #{endDate}
        </if>
        ORDER BY supp.created_date DESC
    </select>

</mapper>